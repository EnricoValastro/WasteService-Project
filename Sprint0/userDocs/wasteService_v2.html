<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!--
    <link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
    <script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    font-weight: 500;
	font-size: 90%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
key{
    font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    font-weight: 500;
	font-size: 100%;
    color: #304ceb;
}
key2{
    font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    font-weight: 500;
	font-size: 100%;
    color: #ad0d0f;
}

key3{
    font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    font-weight: 500;
	font-size: 100%;
    color: #01b948;
}

m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #6dd4f4b5;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
    <meta charset="UTF-8">
    <title>WasteService</title>
</head>
    
<body>
<div id="top">
<h1>LABORATORIO DI INGEGNERIA DEI SISTEMI SOFTWARE <font size="5"></font> </h1>
</div>  

<div class="body"> 
<h2>Introduction</h2>
 
 
<h2>Requirements</h2>
<div class="remark">
    <a href="./resouces/html/TemaFinale22.html">TemaFinale22</a>
</div>

<h2>Requirement analysis</h2>
<div class="remark">
    <h3>Formalization of the requirements</h3>

    <p>
        To formalize the requirements we will use the constructs of the <a href="https://kotlinlang.org/?_gl=1*9jnzrr*_ga*MjM2NjMwNzA5LjE2NjA2NDE3NDI.*_ga_9J976DJZ68*MTY2MTI3MTkwNy4zLjEuMTY2MTI3MjM4OS4wLjAuMA..&_ga=2.160972985.500669650.1661271908-236630709.1660641742">Kotlin</a> language. <br>
        Tuttavia, alcuni requisiti introducono un "abstraction gap", che risulta difficile colmare con i costrutti dei linguaggi di programmazione comuni.
        In order to formalize the requirements we will use the <ks>QActor meta-model</ks> (Qak) developed by our software house. 
        
        The documentation for this meta-model can be found here : <a href="./resouces/html/qak.html" style="color: #0000CD;" ;">QActor meta-model</a>.
    </p>
    

    <h4>Service Area</h4>
    A conventional rectangular room whose dimension are known, free of internal obstacles and bordered by solid walls. We can formalize the room as a rectangle of size "<kc>serviceAreaLength</kc>" and "<kc>serviceAreaWidth</kc>".
    <pre>
<key>val</key> serviceAreaLength :  Float
<key>val</key> serviceAreaWidth   :  Float</pre>

    <h4>PlasticBox</h4>
    Container adibito al deposito di materiale plastico, con capienza massima pari a MAXPB Kg. <br>
    Puo' essere formalizzato usando:
    <ul>
        <li>una costante, <kc>MAXPB</kc>, per indicare la capienza massima del container</li>
        <li>una variabile, <kc>currWeightPb</kc>, che esprime il peso corrente della plastica contenuta nel container.</li>
    </ul> 
    <pre>
<key>val</key> MAXPB             :  Float
<key>var</key> currWeightPb :  Float</pre>

    <h4>GlassBox</h4>
    Container adibito al deposito di materiale vetroso, con capienza massima pari a MAXGB Kg. <br>
    Puo' essere formalizzato usando:
    <ul>
        <li>una costante, <kc>MAXGB</kc>, per indicare la capienza massima del container</li>
        <li>una variabile, <kc>currWeightGb</kc>, che esprime il peso corrente del vetro contenuto nel container.</li>
    </ul> 
    <pre>
<key>val</key> MAXGB             :  Float
<key>var</key> currWeightGb :  Float</pre>

    <h4>Deposit Action</h4>
    Rappresenta una sequenza di azioni eseguite dal <kc>transport trolley</kc>
    <ul>
        <li>prelevare un "waste load" dal "waste truck" che si trova in <kc>INDOOR</kc>. (D'ora in avanti ci riferiremo a questa microazione come <kc>Pickingup</kc>)</li>
        <li>spostare il carico dall'<kc>INDOOR</kc> all'apposito container (<kc>PLASTICBOX</kc> o <kc>GLASSBOX</kc>).</li>
        <li>depositare il carico nel container. (D'ora in avanti ci riferiremo a questa microazione come <kc>Droppingout</kc>)</li>
    </ul>

    <h4>Sonar</h4>

    <h4>Led</h4>

    <h4>DLIMIT</h4>
    Valore prefissato che indica la distanza massima dal sonar a cui un oggetto si puo' trovare senza compromettere il funzionamento del <kc>transport trolley</kc>. <br>
    Puo' essere formalizzato tramite una costante:
    <pre>
<key>val</key> DLIMIT :  Float</pre>

    <h4>TruckLoad</h4>
    Represents the weight, expressed in Kg, of the waste that the waste truck intends to deposit.
    <pre>
<key>var</key> truckLoad :  Float</pre>

    <h4>Type of the material</h4>
    Represents the material, Plastic or Glass, of the waste that the waste truck intends to deposit.
    <pre>
<key>enum</key> <key>class</key> Material { <i>PLASTIC</i>, <i>GLASS</i> }</pre>

    <h4>Current state of the transport trolley</h4>    
    Indicates the status of the <kc>transport trolley</kc>, if it is Idle, Stopped, Moving, Pickingup, Droppingout. <br>
    Puo' essere formalizzato tramite un enumerativo:
    <pre>
<key>enum</key> <key>class</key> CurrStateTrolley { <i>IDLE</i>, <i>STOPPED</i>, <i>MOVING</i>, <i>PICKINGUP</i>, <i>DROPPINGOUT</i> }</pre>

    <h4>Current state of the led</h4>
    Indicates the status of the <kc>led</kc>, if it is On, Blinking, Off. <br>
    <pre>
<key>enum</key> <key>class</key> CurrStateLed { <i>ON</i>, <i>OFF</i>, <i>BLINKING</i> }</pre>

    <h4>Deposit request</h4>
    Rappresenta la richiesta di deposito del meteriale; viene inviata dal guidatore del <kc>Waste-truck</kc> tramite lo Smart device
    e viene ricevuta ed elaborata dal <kc>WasteService</kc>. <br>
    Poichè non esiste alcun costrutto "<i>built-in</i>" nel linguaggio Kotlin o in altri linguaggi "<i>general purpose</i>", per esprimere il concetto di <kc>Request</kc> o 
    <kc>Reply</kc> faremo uso del linguaggio <kc>Qak</kc> che ci permette di superare facilmente questo <kc>abstraction-gap</kc>.
    <pre>
<key2>Request</key2> storeWaste : storeWaste(MATERIAL, TRUCKLOAD)</pre>

    <h4>Loadaccept</h4>
    Rappresenta una risposta positiva che il <kc>WasteService</kc> invia al Truck driver a seguito della ricezione di una <kc>Request storeWaste</kc>
    nel caso in cui sia possibile depositare il carico nell'apposito container. <br>
    La formalizzazione di tale concetto può essere espressa tramite l'utilizzo del linguaggio Qak:
    <pre>
<key2>Reply</key2> loadaccept : loadaccept(_)</pre>

    <h4>Loadrejected</h4>
    Rappresenta una risposta negativa che il <kc>WasteService</kc> invia al Truck driver a seguito della ricezione di una <kc>Request storeWaste</kc>
    nel caso in cui non sia possibile depositare il carico nell'apposito container. <br>
    La formalizzazione di tale concetto può essere espressa tramite l'utilizzo del linguaggio Qak:
    <pre>
<key2>Reply</key2> loadrejected : loadrejected(_)</pre>

    <h4>WasteService</h4>
    E' il servizio che si occupa di coordinare tutte le attività di raccolta e smistamento dei rifiuti, interfacciandosi con il <kc>transport trolley</kc>
    per svolgere le azioni necessarie. <br>
    Il <kc>WasteService</kc> è quindi un'entità attiva che deve essere in grado di ricevere richieste (<kc>storeWaste</kc>) e inviare risposte 
    (<kc>loadaccept</kc>, <kc>loadrejected</kc>). Pertanto può essere formalizzato usando il linguaggio Qak come un <kc>Attore</kc> (<a href="../unibo.wasteService/src/wasteService.qak">wasteService.qak</a>).
    <pre>
<key2>QActor</key2> wasteserviceactor <key2>context</key2> ctxwasteservice {
        <key2>State</key2> setup <key2>initial</key2> {
            ...
        }
        <key2>Goto</key2> idle
        
        <key2>State</key2> idle {
            ...
        }
        <key2>Transition</key2> t0 <key2>whenRequest</key2> storeWaste -> requestEvaluation
        
        <key2>State</key2> requestEvaluation {
            <key2>onMsg</key2>(storeWaste : storeWaste(MAT, QUA)){
                
                <key2>if</key2>[# boxState.canStore(requestMaterialToStore, requestWeightToStore) #]
                {
                    ...
                    <key2>replyTo</key2> storeWaste <key2>with</key2> loadaccept : loadaccept(_)
                }
                <key2>else</key2>{
                    <key2>replyTo</key2> storeWaste <key2>with</key2> loadrejected : loadrejected(_)
                } 
            }
        }
        <key2>Goto</key2> idle
    }</pre>

    Per verificare il corretto funzionamento del <kc>wasteService</kc> e comprendere meglio quale sia il comportamento atteso, abbiamo predisposto
    alcuni semplici test (<a href="../unibo.wasteService/test/unibo/testwasteservice/TestWasteServiceActor.kt">TestWasteServiceActor.kt</a>).

    <pre>
<key>var</key> storeWaste = "msg(storeWaste, request, testunit, wasteserviceactor, storeWaste(PLASTIC, 100),1)"        
<key>var</key> asw = conn.request(storeWaste)
assertTrue(asw.contains("loadaccept"))

<key>var</key> storeWaste = "msg(storeWaste, request, testunit, wasteserviceactor, storeWaste(PLASTIC, 1000),1)"        
<key>var</key> asw = conn.request(storeWaste)
assertTrue(asw.contains("loadrejected"))</pre>

    <h4>DDR Robot</h4>
    Il <kc>Differential Drive Robot</kc> è un robot fisico che esegue diverse mosse di base come:
    <ul>
        <li>muoversi avanti-indietro lungo una direzione costante</li>
        <li>fermarsi</li>
        <li>ruotare di 90° a destra o sinistra</li>
    </ul>
    Queste mosse sono realizzate inviando opportuni comandi al robot. <br>
    Il committente fornisce del software in grado di interfacciarsi con il <kc>DDR Robot</kc> e con altri robot (reali o virtuali):
    <a href="https://github.com/anatali/issLab2022/tree/main/unibo.basicrobot22">unibo.basicrobot22</a>. <br>
    L'attore Qak <a href="./resouces/qak/basicrobot.qak">basicrobot.qak</a> di <kc>unibo.basicrobot22</kc> è in grado di interfacciarsi con il DDR robot e comandare mosse elementari:
    <br> <br>
    Il basicorobot è in grado di eseguire comandi base di spostamento inviando messaggi:
    <pre>
<key3>//MOVE = w | s | l | r | h</key3>
<key2>Dispatch</key2> cmd   :  cmd(MOVE)</pre>
    Servendosi di questi comandi elementari il <kc>basicorobot</kc> è in grado di far eseguire al robot uno <kc>step</kc> ovvero un passo in avanti 
    per il tempo passato come parametro fornendo una risposta, che può essere <kc>stepdone</kc> se lo step viene eseguito con successo 
    o <kc>stepfail</kc> in caso contrario:
    <pre>
<key2>Request</key2> step   :  step(TIME)
<key2>Reply</key2> stepdone :  stepdone(V)
<key2>Reply</key2> stepfail :  stepfail(DURATION, CAUSE)
    </pre>




</div>

<div class="remark">
    <h3>User Stories</h3>
    In order to make the images that describe the User Stories more understandable, we introduce the following legend:
    <br><br>
    <img src="./resouces/images/uSLegend.drawio.png" alt="">
    <h4>Store waste</h4>
    <p>
        As a waste truck driver:
        <ul>
            <li>
                When I arrive in the <kc>Indoor</kc> area, I intend to notify my interest in depositing a waste load through a smart device <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">1</div>.
                I expect the <kc>WasteService</kc> to provide some tools to specify the type of load (Plastic or Glass) and the weight of the load. 
                I expect to receive a positive (<kc>loadaccept</kc>) <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">2a</div> or negative (<kc>loadrejected</kc>) <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">2b</div> response.
            </li>
            <li>
                If the response is positive (<kc>loadaccept</kc>), I expect the <kc>transport trolley</kc> to pick up the waste load <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">3</div> and move it from the <kc>Indoor</kc> area to the appropriate container <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">5</div>. In any case as soon as the <kc>transport trolley</kc> takes the waste load, I free the <kc>Indoor</kc> area and leave <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">4</div>.
            </li>
            <li>
                If the received answer is negative (<kc>loadrejected</kc>), I will free the <kc>Indoor</kc> area and go away <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">3</div>. 
            </li>
        </ul>
        <div style="display: flex; justify-content: space-around;">
            <img src="./resouces/images/uSIndoorArrival1.drawio.png" alt="" style="width: 40%;"><img src="./resouces/images/uSIndoorArrival2.drawio.png" alt="" style="width: 40%;">
        </div>
    </p>
    <h4>Supervise service-area </h4>
    <p>
        As a service-manager, I intend to use the <kc>WasteServiceStatusGUI</kc> provided by the <kc>WasteService</kc> to observe:
        <ul>
            <li>
                The current state of the <kc>transport trolley</kc> (working <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">1</div>, stopped <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">2</div>, idle <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">3</div>) and its position in the room.
                <br><br>
                <img src="./resouces/images/uSSuperviseStatus1.drawio.png" alt="" style="width: 40%;">    
            </li>
            <li>
                The current weigth of the material stored in the two waste-containers <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">3</div> <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">4</div>.
                <br><br>
                <img src="./resouces/images/uSSuperviseStatus2.drawio.png" alt="" style=" width: 40%;">
            </li>
            <li>
                The current state of the Led (off, on, blinking) <div style="border: 2px solid #00FFFF; display:inline-block; border-radius: 100%;height: 20px;width: 20px;text-align: center;">5</div>.
                <br><br>
                <img src="./resouces/images/uSSuperviseStatus3.drawio.png" alt="" style="width: 40%;">
            </li>
        </ul>
    </p>
</div>


<h2>Problem analysis</h2>
 









 
<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->
	      	
<br/><br/> 	

<div style="background-color:rgba(60, 131, 186, 0.9); width:50%;text-align:center;color:white; margin-left: 25%; border-radius: 25px;" >
    <br>
    By students: <br>
    Name: Annamaria Simonitto, Enrico Valastro, Alessio Reitano   
    <br>
    Email: annamaria.simonitto@studio.unibo.it, enrico.valastro@studio.unibo.it, alessio.reitano@studio.unibo.it
    <br><br>
    <img src="./resouces/images/AnnamariaSimonitto.jpg" alt="" width="8%" height="8%">
    <img src="./resouces/images/EnricoValastro.jpeg" alt="" width="8.5%" height="8.5%">
    <img src="./resouces/images/AlessioReitano.jpeg" alt="" width="10%" height="10%">
</div> 
</body>
</html>