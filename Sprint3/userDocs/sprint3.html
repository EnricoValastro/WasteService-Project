<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!--
    <link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
    <script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
    body
    {
        margin-left:  30px;
        margin-right: 30px;
    };
    
    P
    {
        font-family: Tahoma;
        font-size: 10pt;
    };
    
    a, a:visited, a:active, a:link, a:hover {
        text-decoration: underline;
        color: #545454;
        background-color: transparent;
        font-size: 93%;
    }
    
    a:hover {
        background-color: #cccccc;
    }
    
    
    hr {
        clear: both;
        height: 1px;
        color: #242424;
        background-color: transparent;
    }
    
    h1, h2, h3 {
        color: #242424;
        clear: left;
        font: 100% Tahoma, Helvetica, Arial, sans-serif;
        margin-bottom: 0.5em;
        padding-top: 0.5em;
        border-radius: 10px;
        padding: 5px;
    }
    
    top {
        width: 100%;
    }
    
    
    #i {
        color: #ff1010;
    }
    tt{
        font-family: "Arial";
        font-size: 90%;
        color: #006600;
    }
    em{
        font-family: "Arial";
        font-size: 80%;
        font-weight: bold;
        border-style:solid;
        border-color: #abe876;
        color: #1632cc;
    }
    bc{
        font-family: "Arial";
        font-size: 90%;
        font-weight: bold;
        color: #990000;
        background-color: #fcf8c7;
    }
    ks{
        font-family: "Arial";
        font-weight: bold;
        color: #0000CD	;
        font-size: 90%;
    }
    kc{
        font-family: "Arial";
        font-weight: bold;
        color: #008000	;
        font-size: 90%;
    }
    pre{
        font-family:monospace;
        font-weight: 500;
        font-size: 85%;
        background-color: #f5f5f5;
        border: 1.5px solid silver;
        padding: 5px;
    }
    key{
        font-family:monospace;
        font-weight: 500;	
        color: #304ceb;
    }
    key2{
        font-family:monospace;
        font-weight: 500;
        color: #ad0d0f;
    }
    
    key3{
        font-family:monospace;
        font-weight: 500;
        color: #01b948;
    }
    
    key4{
        font-family:monospace;
        font-weight: 500;
    
        color: #008232;
    }
    
    pro{
        font-weight: bold;
        color:blue;
    }
    cons{
        font-weight: bold;
        color: red;
    }
    
    m{
        font-family: "Helvetica";
        line-height: 100%;
         font-size: 75%;
    }
    div.body{
         
        font-size: 18px;
    }
    k{
        color: #990000;
        font-weight: bold;
        font-size: 90%;
    }
    h1 {
        font-size: 150%;
        background-color: #b2c0ff;
        padding: 10px;
    }
    
    h2 {
        background-color: #9ed8ff;
        font-size: 130%;
    }
    
    h3 {
        background-color: #e6ccff;
        font-size: 100%;
    }
    h3.test{
        background-color: #42b966;
        font-size: 100%;
    }
    h4 {
        background-color: #6dd4f4b5;
        font-size: 100%;
        width: 100%;
        border-radius: 5px;
        padding: 2px;
    }
    h4.test{
        background-color: #5ee887;
        font-size: 100%;
    }
    h5 {
        background-color: #91df4d;
        font-size: 100%;
        width: 100%;
        border-radius: 5px;
        padding: 2px;
    }
    div.req{
        background-color: #d9ffb3;
        font-size: 18px;
        width: 700px;
        border: 3px solid green;
        padding: 15px;
        margin: 10px;
    }
    div.remark{
        background-color: #E3F2FD;
        border: 1.5px solid #E3F2FD;
        padding: 15px;
        margin: 10px;
        border-radius: 25px;
    }
    div.remarkTest{
        background-color: #d4fbd7;
        border: 1.5px solid #d4fbd7;
        padding: 15px;
        margin: 10px;
        border-radius: 25px;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    
    ol, ul, li {
      margin: 0;
      margin-left: 10px;
      padding: 0;
      padding-bottom: 5px;
    }
    
    table, th, td {
        border: 1px solid black;
    }
    
    img {
        border: 1.5px solid #d5f2ed
    
    }
    
    a, a:visited, a:active, a:link, a:hover {
        text-decoration: underline;
        color: #545454;
        background-color: transparent;
    }
    
    div.wrapdesc{
        width: 90%;
        margin: auto;
    }
    
    div.imagedesc{
        width: 85%;
        margin: auto;
    }
    </style>
    
<head>
    <meta charset="UTF-8">
    <title>Sprint3</title>
</head>
    
<body>
    <div id="top">
        <h1>LABORATORIO DI INGEGNERIA DEI SISTEMI SOFTWARE <font size="5"></font> </h1>
    </div>  

    <div class="body"> 
        <a href="../../Sprint0/userDocs/sprint0.html">Sprint 0</a>
        <a href="../../Sprint1/userDocs/sprint1.html">Sprint 1</a>
        <a href="../../Sprint2/userDocs/sprint2.html">Sprint 2</a>
        <a href="./sprint3.html">Sprint 3</a>
        
        <h2>Introduction</h2>
        <div class="remark">
            Progetto finale di ISS finalizzato allo sviluppo software di un impianto di smistamento dei rifiuti attraverso un robot che preleva il carico del camion e lo porta al container appropriato
        </div>

        <h2>Requirements</h2>
        <div class="remark">
            <a href="../../Sprint0/userDocs/resouces/html/TemaFinale22.html">TemaFinale22</a>
        </div>

        <h2>Work Plan</h2>
        <div class="remark">
            In questo Sprint ci occuperemo dello sviluppo di <kc> Sonar</kc> e <kc>Led </kc>collocati sul RaspberryPI. <br>
            Il <i> Sonar </i> verrà usato come un 'alarm device', infatti alla presenza di un ostacolo rilevato dal Sonar, il transportTrolley si fermerà. Il valore entro cui il Sonar rileva
            l'ostacolo sarà un valore prefissato <kc> DLIMIT</kc>. <br>
            Il <i> Led</i> verrà usato per indicare lo stato del transportTrolley :
            <ul>
                <li>LED off quando il transportTrolley è in HOME</li>
                <li>LED blinks quando il transportTrolley è in movimento(pickup,dropout,gotoHome). <br>
                    (se il robot si trova in HOME ma si sta girando (magari per riposizionarsi dopo aver gestito una depositaction),
        il Led deve comunque lampeggiare(detto dal committente)). </li>
                <li>
                    LED on quando il transportTrolley è fermo/stopped.
                </li>
            
            </ul>
        </div>

        <h2>Checkpoint Sprint2</h2>
        <div class="remark">
            <h3>Sprint2 result</h3>
            Al termine dello <a href="../../Sprint2/userDocs/sprint2.html">Sprint2</a>, l'architettura logica del sistema è la seguente: <br></br>
            <img src="../../Sprint2/userDocs/resources/img/ArchLogicSprint2Final.png" alt="" style="width: 60%; height: 60%">
            <br>
        </div>

        <h2>Problem analysis</h2>
    
        <div class="remark">
            <h3>Led</h3>
            Dall'analisi dei requisiti, si evince che il <kc>Led</kc> è un componente fisico, connesso ad un <kc>RaspberryPI</kc>, che deve <i>Accendersi</i>, <i>Spegnersi</i> o <i>Lampeggiare</i> in funzione 
            dello stato del componente <kc>TransportTrolley</kc>. <br>
            Si aprono, quindi, diverse problematiche. In particolare, sarà necessario comprendere:
            <ul>
                <li>Come fa il <i>Led</i> ad accendersi, spegnersi o lampeggiare. </li>
                <li>Come fa il <i>Led</i> a sapere quando è il momento di eseguire una delle tre azioni.</li>
                <li>Come è possibile rappresentare e mantenere lo stato del <i>Led</i>.</li>
            </ul>
            
            <h4>Azioni del Led</h4>
            Per accendere e spegnere il <i>Led</i> collegato al <kc>RaspberryPI</kc>, è possibile utilizzare il software fornito dal committente. <br>
            In particolare ci sono stati forniti due file <ks>Bash</ks>, <a href="https://github.com/anatali/issLab2022/blob/main/it.unibo.raspIntro2022/code/bash/led25GpioTurnOn.sh">led25GpioTurnOn.sh</a> e <a href="https://github.com/anatali/issLab2022/blob/main/it.unibo.raspIntro2022/code/bash/led25GpioTurnOff.sh">led25GpioTurnOff.sh</a>. <br>
            Oltre a questi due file, che permettono di operare sul <i>Led</i> a livello fisico, il committente ci ha fornito anche il del software, 
            <a href="https://github.com/anatali/issLab2022/tree/main/it.unibo.radarSystem22.domain">it.unibo.radarSystem22.domain</a>, che permette di 
            definire dei componenti di base legati ai dispositivi di I/O (<i>Led</i>, <i>Sonar</i>). <br>
            Tali componenti componenti sono descritti dalle seguenti interfacce:

            <pre>
<key>public interface</key> ILed {
    <key>public void</key> turnOn();
    <key>public void</key> turnOff();
    <key>public boolean</key> getState();
}</pre>

            <pre>
<key>public interface</key> ISonar {
    <key>public void</key> activate();
    <key>public void</key> deactivate();
    <key>public IDistance</key> getDistance();
    <key>public boolean</key> isActive();
}</pre>

            Il software fornito dal committente permette l'utilizzio di dispositivi simulati (<ks>Mock-object</ks>) e dispositivi reali. <br>
            Per fare ciò viene introdotta una classe astratta, comune alle due tipologie, che funge da <ks>Factory</ks> per quel tipo di dispositivo. <br>
            La classe astratta <a href="https://github.com/anatali/issLab2022/blob/main/it.unibo.radarSystem22.domain/src/it/unibo/radarSystem22/domain/models/LedModel.java">LedModel.java</a> 
            introduce il metodo <i>astratto</i> <kc>LedActivate</kc> a cui è demandato il compito di accendere/spegnere il <i>Led</i>.
            <pre>
<key>public abstract class</key> LedModel <key>implements</key> ILed{
    <key>private boolean</key> state = false;
    
    <key>public static</key> ILed create() {
        ...
    }
    <key>public static</key> ILed createLedMock(){ <key>return new</key> LedMock(); }
    <key>public static</key> ILed createLedConcrete(){ <key>return new</key> LedConcrete(); }
    
    <key>protected abstract void</key> ledActivate( <key>boolean</key> val);
    
    <key>protected void</key> setState( <key>boolean</key> val ) {
        state = val;
        ledActivate( state );
    }
    @Override
    <key>public void</key> turnOn(){ setState( true ); }
    @Override
    <key>public void</key> turnOff() { setState( false ); }
    @Override
    <key>public boolean</key> getState(){  return state;  }
}</pre>

            Tale classe astratta è estesa dalle classi <a href="https://github.com/anatali/issLab2022/blob/main/it.unibo.radarSystem22.domain/src/it/unibo/radarSystem22/domain/mock/LedMock.java">LedMock.java</a> e <a href="https://github.com/anatali/issLab2022/blob/main/it.unibo.radarSystem22.domain/src/it/unibo/radarSystem22/domain/concrete/LedConcrete.java">LedConcrete.java</a> che implementano rispettivamente i dispositivi simulati e reali. <br>
            Il comportamento del <kc>LedMock</kc> è già definito dal <kc>LedModel</kc>, in quanto questo tiene traccia dello statto del <i>Led</i> in una variabile. <br>
            <pre>
<key>public class</key> LedMock <key>extends</key> LedModel <key>implements</key> ILed{
    @Override
    <key>protected void</key> ledActivate( <key>boolean</key> val) {
        ColorsOut.outappl("LedMock state=" + getState(), ColorsOut.MAGENTA );
    }
}</pre>
            Per quanto riguarda il <kc>LedConcrete</kc>, esso realizza la logica di gestione di un Led reale avvalendosi dei file <ks>Bash</ks> forniti dal committente. <br>
            <pre>
<key>public class</key> LedConcrete <key>extends</key> LedModel <key>implements</key> ILed{
    <key>private</key> Runtime rt  = Runtime.getRuntime();
    @Override
    <key>protected void</key> ledActivate(<key>boolean</key> val) {
        <key>try</key> {
            <key>if</key>( val ) rt.exec( "sudo bash led25GpioTurnOn.sh" );
            <key>else</key>      rt.exec( "sudo bash led25GpioTurnOff.sh" );
        } <key>catch</key> (IOException e) { ... }
    }
}</pre>
            Considerando che il software fornito dal committente è perfettamente funzionante, consigliamo agli sviluppatori di utilizzare tale software per la gestione del <i>Led</i>. 
            Tuttavia, dal momento che il componente <i>Led</i> deve essere in grado di interagire con gli altri componenti del sistema, consigliamo agli sviluppatori di modellare il <i>Led</i> 
            come un <ks>attore QAk</ks> che incapsula le funzionalità del software fornito dal committente. In questo modo si può dotare il <i>Led</i> dell'abilità di comunicare a scambio di messaggi. <br>



            <h4>Interazione tra i componenti</h4>

            
            <h4>Stato del Led</h4>
            Dall'analisi dei requisiti è emerso che il committente vuole che sia mostrato lo stato del Led nella <kc>GUI</kc>. Per fare ciò è necessario gestire e mantanere lo stato del Led. 
            Inoltre, dall'analisi dei requisiti è emerso che lo stato del Led può essere rappresentato dal seguente enumerativo:
            <pre>
<key>enum class</key> CurrStateLed{ <i>ON</i>, <i>OFF</i>, <i>BLINKING</i>}</pre>
            Lo stato può essere mantenuto in due modi differenti:
            <ul>
                <li>Cablare lo stato del Led all'interno del componente Led.</li>
                <li>Mantenere lo stato del Led usando una <ks>data class Kotlin</ks>.</li>
            </ul>
            <h5>Stato cablato</h5>
            Questa soluzione prevede di mantenere lo stato all'interno del file QAk del Led. <br>
            <pre>
<key2>QActor</key2> led <key2>context</key2> ctxpi{
    [#
        var ledState : CurrStateLed
    #]
}</pre>
            Sebbene questa soluzione sia semplice, da al componente Led la responsabilità di mantenere lo stato del Led e di aggiornare la <i>GUI</i>. 
            Inoltre affinchè la <i>GUI</i> possa mostrare lo stato del Led, è necessario che la GUI apra una connnesione Coap con il Led. <br>
            <h5>Data class</h5>
            Questa soluzione prevede di mantenere lo stato del Led in una <ks>data class Kotlin</ks>, togliendo in questo modo la responsabilità al Led.
            <pre>
<key>enum class</key> CurrStateLed { <i>ON</i>, <i>OFF</i>, <i>BLINKING</i> }
<key>data class</key> SystemState (
        <key>private var</key> currLedState : CurrStateLed
) {
    <key>fun</key> getCurrLedState() : CurrStateLed 
    <key>fun</key> setCurrLedState(currLedState : CurrStateLed)
}</pre>
            Sebbene questa soluzione sia più complessa da implementare, è quella che consigliamo agli sviluppatori in quanto permette di disaccoppiare la gestione dello stato dalle funzionalità del Led.
            <h4>Gestione dello stato del Led</h4>
            Per quanto riguarda la gestione dello stato del Led, essa viene effettuata da un componente creato ad-hoc, il <kc>SystemStateManager</kc> , che si occupa di mantenere lo stato del sistema. <br>
            Affinchè questo avvenga, il Led attraverso l'invio di messaggi, dirà al SystemStateManager i suoi cambiamenti si stato.
            <pre>
<key>Dispatch</key> updateled : updateled(STATE)</pre>
        </div>

        <div class="remark">
            <h3>Sonar</h3>
            Dall'analisi dei requisiti è emerso che il Sonar verrà usato come un 'alarm device'. Si deve capire come fermare il trolley nel caso di un'allarme 
            e come fargli riprendere il movimento. <br>
            Per fermare il trolley, è necessario che il Sonar invii un messaggio al <kc>TransportTrolley</kc> che lo gestirà. <br> 
            Come avviene l'interazione? <br>
            Che tipo di messaggi manda il Sonar? <br>
        </div>
        

        <div class="remark">
            <h3>Architettura Logica</h3>
            Sulla base di quanto emerso in fase di analisi del problema è possibile ridefinire l'architettura logica del sistema.<br> 
            <br><br>
            <img src="" alt="" style="width:60% ; height:60% ;">
        </div>
        <h2>Project</h2>
        <div class="remark"></div>


        <h2>Test Plan</h2>
        <div class="remarkTest"></div>

        <div style="display: flex; flex-direction: row; justify-content: space-around;">
            <div><a href="../../Sprint2/userDocs/sprint2.html"> <-- Sprint2</a></div>
        </div>
        <br><br>
        <div style="background-color:rgba(60, 131, 186, 0.9); width:50%;text-align:center;color:white; margin-left: 25%; border-radius: 25px;" >
            <br>
            By students: <br>
            Name: Annamaria Simonitto, Enrico Valastro, Alessio Reitano   
            <br>
            Email: annamaria.simonitto@studio.unibo.it, enrico.valastro@studio.unibo.it, alessio.reitano@studio.unibo.it
            <br><br>
            <img src="../../Sprint0/userDocs/resouces/images/AnnamariaSimonitto.jpg" alt="" width="8%" height="8%">
            <img src="../../Sprint0/userDocs/resouces/images/EnricoValastro.jpeg" alt="" width="8.5%" height="8.5%">
            <img src="../../Sprint0/userDocs/resouces/images/AlessioReitano.jpeg" alt="" width="10%" height="10%">
        </div> 
    </div>
</body>
</html>